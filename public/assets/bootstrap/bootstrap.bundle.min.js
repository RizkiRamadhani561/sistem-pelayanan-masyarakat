// Minimal Bootstrap 5 JavaScript for core functionality
(function() {
    'use strict';

    // DOM Content Loaded
    function ready(fn) {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fn);
        } else {
            fn();
        }
    }

    // Toast functionality
    class Toast {
        constructor(element) {
            this.element = element;
            this.hideTimeout = null;
        }

        show() {
            this.element.classList.add('show');
            if (this.element.hasAttribute('data-bs-autohide') !== false) {
                this.hide();
            }
        }

        hide() {
            if (this.hideTimeout) clearTimeout(this.hideTimeout);
            this.hideTimeout = setTimeout(() => {
                this.element.classList.remove('show');
            }, this.element.getAttribute('data-bs-delay') || 5000);
        }
    }

    // Modal functionality
    class Modal {
        constructor(element) {
            this.element = element;
            this.backdrop = null;
        }

        show() {
            this.element.style.display = 'block';
            this.element.classList.add('show');
            this.createBackdrop();
            document.body.classList.add('modal-open');
        }

        hide() {
            this.element.classList.remove('show');
            setTimeout(() => {
                this.element.style.display = 'none';
                this.removeBackdrop();
                document.body.classList.remove('modal-open');
            }, 150);
        }

        createBackdrop() {
            this.backdrop = document.createElement('div');
            this.backdrop.className = 'modal-backdrop fade show';
            document.body.appendChild(this.backdrop);
        }

        removeBackdrop() {
            if (this.backdrop) {
                this.backdrop.remove();
                this.backdrop = null;
            }
        }
    }

    // Initialize components
    ready(function() {
        // Initialize toasts
        const toastElements = document.querySelectorAll('.toast');
        toastElements.forEach(element => {
            const toast = new Toast(element);

            // Handle close button
            const closeBtn = element.querySelector('.btn-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => toast.hide());
            }

            // Auto-show if has show class
            if (element.classList.contains('show')) {
                toast.show();
            }
        });

        // Initialize modals
        const modalElements = document.querySelectorAll('.modal');
        modalElements.forEach(element => {
            const modal = new Modal(element);

            // Handle modal triggers
            const triggers = document.querySelectorAll(`[data-bs-target="#${element.id}"]`);
            triggers.forEach(trigger => {
                trigger.addEventListener('click', () => modal.show());
            });

            // Handle close buttons
            const closeButtons = element.querySelectorAll('[data-bs-dismiss="modal"]');
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => modal.hide());
            });

            // Handle backdrop click
            element.addEventListener('click', (e) => {
                if (e.target === element) {
                    modal.hide();
                }
            });
        });

        // Handle dropdowns
        const dropdownElements = document.querySelectorAll('.dropdown-toggle');
        dropdownElements.forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                const menu = this.nextElementSibling;
                if (menu && menu.classList.contains('dropdown-menu')) {
                    menu.classList.toggle('show');
                }
            });
        });

        // Handle navbar toggler
        const navbarTogglers = document.querySelectorAll('.navbar-toggler');
        navbarTogglers.forEach(toggler => {
            toggler.addEventListener('click', function() {
                const target = document.querySelector(this.getAttribute('data-bs-target'));
                if (target) {
                    target.classList.toggle('show');
                }
            });
        });

        // Handle collapse
        const collapseElements = document.querySelectorAll('.collapse');
        collapseElements.forEach(element => {
            const toggles = document.querySelectorAll(`[data-bs-target="#${element.id}"]`);
            toggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    element.classList.toggle('show');
                });
            });
        });

        // Handle tabs
        const tabElements = document.querySelectorAll('[data-bs-toggle="tab"]');
        tabElements.forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();

                // Remove active class from siblings
                const siblings = this.parentElement.querySelectorAll('[data-bs-toggle="tab"]');
                siblings.forEach(sib => sib.classList.remove('active'));

                // Add active class to current
                this.classList.add('active');

                // Hide all tab panes
                const target = document.querySelector(this.getAttribute('data-bs-target'));
                const panes = target.parentElement.querySelectorAll('.tab-pane');
                panes.forEach(pane => pane.classList.remove('show', 'active'));

                // Show target tab pane
                target.classList.add('show', 'active');
            });
        });

        // Handle tooltips (basic)
        const tooltipElements = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltipElements.forEach(element => {
            element.addEventListener('mouseenter', function() {
                const title = this.getAttribute('title') || this.getAttribute('data-bs-original-title');
                if (title) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip show';
                    tooltip.innerHTML = `<div class="tooltip-inner">${title}</div>`;
                    document.body.appendChild(tooltip);

                    const rect = this.getBoundingClientRect();
                    tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
                    tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
                }
            });

            element.addEventListener('mouseleave', function() {
                const tooltips = document.querySelectorAll('.tooltip');
                tooltips.forEach(tooltip => tooltip.remove());
            });
        });
    });

    // Global bootstrap object
    window.bootstrap = {
        Toast: Toast,
        Modal: Modal
    };

})();
